<?xml version="1.0" encoding="UTF-8"?>
<persistence xmlns="https://jakarta.ee/xml/ns/persistence"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="
                https://jakarta.ee/xml/ns/persistence
                https://jakarta.ee/xml/ns/persistence/persistence_3_2.xsd" version="3.2">

<persistence-unit name="PersistenciaInstituto" transaction-type="RESOURCE_LOCAL">

<!-- En JPA solo hay dos valores vÃ¡lidos:
				 	RESOURCE_LOCAL:  Nuestra aplicaciÃ³n gestiona las transacciones (mediante EntityTransaction)
					JTA: es el contenedor o servidor quien las gestiona 
-->

<!-- AquÃ­ debemos indicar las clases a persistir que dispondrÃ¡n de las correspondientes anotiaciones JPA -->
<class>es.ciudadescolar.dominio.modelo.Alumno</class>


<properties>

			<!-- Proveedor JPA entre otros:
			  <provider>org.eclipse.persistence.jpa.PersistenceProvider</provider>
			-->
			<property name="jakarta.persistence.provider" value="org.hibernate.jpa.HibernatePersistenceProvider"/>

			<!-- En Hibernate 6/7 es mejor no habilitar esto pues con org.hibernate.SQL 
				y org.hibernate.orm.jdbc.bind ya recuperamos todos los SQL 
			<property name="hibernate.show_sql" value="true" /> 
			-->

			<!--  JPA estÃ¡ diseÃ±ado para manejar las transacciones explÃ­citamente, agrupando operaciones segÃºn sea necesario. -->

			<property name="hibernate.format_sql" value="true" />
			<!--  el SQL generado se mostrarÃ¡ con saltos de lÃ­nea y sangrÃ­a para que sea mÃ¡s fÃ¡cil de leer. -->

			<property name="hibernate.highlight_sql" value="true"/>
			<!--  el SQL generado se mostrarÃ¡ en colores por consola. -->


			<!-- El aislamiento lo decide el SGBD o el pool, JPA solo gestiona transacciones lÃ³gicas
			<property name="hibernate.hikari.transactionIsolation" value="TRANSACTION_REPEATABLE_READ"/>
			   Nivel de aislamiento considerado para las transacciones:
    			1: TRANSACTION_READ_UNCOMMITTED
    			2: TRANSACTION_READ_COMMITTED (valor predeterminado en MySQL)
	    		4: TRANSACTION_REPEATABLE_READ (nivel predeterminado de MySQL InnoDB)
    			8: TRANSACTION_SERIALIZABLE
			-->

			<!-- En Hibernate 6/7 no es necesario especificar ya el dialecto de SGBDs pues lo detecta automÃ¡ticamente
			<property name="hibernate.dialect" value="org.hibernate.dialect.MySQLDialect" /> 
			-->

			<!-- Pool de conexiones (HikariCP) -->
			<property name="hibernate.hikari.poolName" value="HibernateHikariPool"/>

			<property name="hibernate.hikari.minimumIdle" value="2"/>
			<!--  NÃºmero mÃ­nimo de conexiones ociosas en el pool -->
			<property name="hibernate.hikari.maximumPoolSize" value="5"/>
			<!--  NÃºmero mÃ¡ximo de conexiones simultaneas en el pool -->

			<property name="hibernate.hikari.idleTimeout" value="30000"/>
			<!--  Tiempo mÃ¡ximo de inactividad (en milisegundos) antes de que una conexiÃ³n sea eliminada -->

			<property name="hibernate.hikari.validationTimeout" value="5000"/>
			<!--  Tiempo mÃ¡ximo de validaciÃ³n (en milisegundos)-->

			<property name="hibernate.generate_statistics" value="true" />
			<!--  Se activa la generaciÃ³n de estadÃ­sticas detalladas sobre el rendimiento de las operaciones. Penaliza rendimiento -->

			<!-- H2, por defecto, almacena la base de datos persistentemente en un fichero con extensiÃ³n .mv.db
			 Cada vez que ejecutas la app:
			 	-Hibernate lee/actualiza este fichero
				-Las tablas y registros persisten entre ejecuciones
			
				Si prefiero que sÃ³lo estÃ© la BD en RAM mientras nuestra app estÃ© abierta:
					<property name="jakarta.persistence.jdbc.url" value="jdbc:h2:mem:instituto"/>
			-->
			<property name="hibernate.hikari.jdbcUrl" value="jdbc:h2:./data/instituto;AUTO_SERVER=TRUE"/>
			<property name="hibernate.hikari.username" value="sa"/> <!-- System Administrator, usuario por defecto de H2 -->
			<property name="hibernate.hikari.password" value=""/> <!-- Password vacÃ­o = prÃ¡ctica comÃºn para bases de desarrollo. Nunca PRODUCCIÃ“N-->

            <!-- Con hibernate.hbm2ddl.auto = update: Se actualiza automÃ¡ticamente el esquema de la base de datos 
			segÃºn las entidades JPA cada vez que arranca la aplicaciÃ³n. Cuando la aplicaciÃ³n se inicia, Hibernate:
				Posibles valores:

                | Valor         | QuÃ© hace                          | Â¿Se usa en empresa? |
                | `none`        | No toca la BBDD                   | âœ… ProducciÃ³n       |
                | `validate`    | Comprueba que el esquema coincide | âœ… ProducciÃ³n       |
                | `update`      | Actualiza esquema automÃ¡ticamente | âš ï¸ Desarrollo       |
                | `create`      | Borra y crea todo                 | âŒ No               |
                | `create-drop` | Crea al iniciar, borra al cerrar  | âŒ No               |

                ðŸ“Œ En producciÃ³n: Hibernate NO debe modificar el esquema. Se usan: validate y none
            -->
            <property name="hibernate.hbm2ddl.auto" value="update"/>

		</properties>

</persistence-unit>


</persistence>